<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Pathway</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <style>
        .fade-in {
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        :root {
            --text-color: #ffffff;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --accent-color: #ff4081;
            --accent-hover: #e91e63;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-top: 76px;
            /* Account for fixed navbar */
        }


        .card {
            border-radius: 20px;
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow-wrap: break-word;
            background-color: var(--card-bg, #2c2f33);
            color: var(--card-text, #ffffff);
            perspective: 1000px;
            position: relative;
            margin-bottom: 2rem;
            transition: background-color 0.3s, color 0.3s;
        }

        .card-body {
            padding: 1.5rem;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            position: relative;
            transform-origin: center right;
        }

        .card.loading .card-body {
            transform: rotateY(180deg);
        }

        .spinner-border {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .card.loading .spinner-border {
            display: block;
        }

        .btn-primary {
            background-color: #ff4081;
            border-color: #ff4081;
            transition: background-color 0.3s, border-color 0.3s;
            position: relative;
        }

        .btn-primary:hover {
            background-color: #e91e63;
            border-color: #e91e63;
        }

        .btn-spinner {
            display: none;
            position: absolute;
            right: 1rem;
        }

        .btn-primary.loading .btn-spinner {
            display: inline-block;
        }

        .btn-primary.loading .btn-text {
            visibility: hidden;
        }

        body.light-mode .card {
            background-color: #ffffff;
            color: #000000;
        }

        body.light-mode .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

        body.light-mode .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        body.light-mode .text-light {
            color: #000000 !important;
        }

        body.light-mode .bg-dark {
            background-color: #ffffff !important;
        }

        .svg-container {
            width: 100%;
            height: 80vh;
            background-color: var(--card-bg, #2c2f33);
            color: var(--card-text, #ffffff);
            border-radius: 20px;
            padding: 1.5rem;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .svg-container {
                height: 60vh;
            }
        }

        /* User profile styles */
        .profile-summary {
            margin-bottom: 2rem;
        }

        .profile-summary p {
            margin-bottom: 0.5rem;
        }

        /* Navigation styles */
        .navbar {
            background: rgba(0, 0, 0, 0.7) !important;
            backdrop-filter: blur(10px);
            padding: 0.8rem 1rem;
        }

        .navbar-brand {
            color: var(--text-color);
            font-weight: bold;
        }

        .nav-link {
            color: var(--text-color) !important;
            margin: 0 5px;
            transition: color 0.3s;
        }

        .nav-link:hover {
            color: var(--accent-color) !important;
        }

        .dropdown-menu {
            background-color: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--accent-color);
        }

        .dropdown-item {
            color: var(--text-color);
        }

        .dropdown-item:hover {
            background-color: var(--accent-color);
            color: white;
        }

        /* Light mode styles */
        body.light-mode {
            --text-color: #212529;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --accent-color: #ff4081;
            --accent-hover: #e91e63;
        }

        body.light-mode .navbar {
            background: rgba(248, 249, 250, 0.7) !important;
        }

        body.light-mode .dropdown-menu {
            background-color: rgba(248, 249, 250, 0.9);
            border: 1px solid var(--accent-color);
        }

        /* Add padding for fixed-top navbar */
        .card {
            border-radius: 20px;
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            background: rgba(0, 0, 0, 0.7) !important;
            color: var(--card-text);
        }

        .card-body {
            padding: 1.5rem;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        /* Enhanced card styling with glass effect */
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .card.loading {
            opacity: 0.7;
            pointer-events: none;
            position: relative;
        }

        .card.loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            z-index: 1;
        }

        /* Enhanced button styling */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .btn-primary.loading {
            pointer-events: none;
            opacity: 0.8;
        }

        /* Profile summary enhanced styling */
        .profile-summary {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .profile-summary .card-title {
            color: #667eea;
            font-weight: 700;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Enhanced user summary styling */
        #user-summary {
            display: grid;
            gap: 1rem;
        }

        #user-summary p {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px 16px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            margin: 0;
            transition: all 0.3s ease;
        }

        #user-summary p:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        #user-summary strong {
            color: #667eea;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* SVG container styling */
        .svg-container {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 15px;
            min-height: 500px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .svg-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        /* Alert styling */
        .alert {
            border-radius: 12px;
            border: none;
            padding: 16px 24px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .alert-warning {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            color: #2d3436;
        }

        .alert-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        /* Loading spinner styling */
        .btn-spinner {
            display: none;
            margin-left: 8px;
        }

        .btn.loading .btn-spinner {
            display: inline-block;
        }

        .btn.loading .btn-text {
            opacity: 0.7;
        }

        /* Title styling */
        .text-center.mb-4.text-light {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 2.5rem;
            text-shadow: none;
            margin-bottom: 3rem !important;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .card {
                margin: 0 10px 2rem 10px;
                border-radius: 15px;
            }

            .text-center.mb-4.text-light {
                font-size: 2rem;
            }

            .svg-container {
                min-height: 400px;
                padding: 15px;
            }
        }

        /* Enhanced D3 node styling */
        .nodes circle {
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
        }

        .nodes circle:hover {
            filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5));
            transform: scale(1.1);
        }

        .links line {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }
    </style>
</head>

<body class="dark-mode">
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="logo2-removebg-preview.png" alt="VisionVenture" style="width: 100%;
  height: 60px;
  object-fit: cover;
   overflow: hidden; display: block; margin: auto;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home"></i> Home
                        </a>
                    </li>
                    <!-- Logged-in navigation items -->
                    <li class="nav-item logged-in-nav">
                        <a class="nav-link" href="dashboard.html">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item logged-in-nav">
                        <a class="nav-link" href="career-pathway.html">
                            <i class="fas fa-road"></i> Career Pathway
                        </a>
                    </li>
                    <li class="nav-item logged-in-nav">
                        <a class="nav-link" href="resume-advice.html">
                            <i class="fas fa-file-alt"></i> Resume Advice
                        </a>
                    </li>
                    <!-- Profile Dropdown
                    <li class="nav-item dropdown logged-in-nav">
                        <a class="nav-link dropdown-toggle" href="#" id="profileMenu" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle"></i> <span class="username">User</span>
                        </a>
                    </li> -->
                    <!-- Logged-out navigation items -->
                    <!-- <li class="nav-item logged-out-nav">
                        <a class="nav-link" href="login.html">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </li>
                    <li class="nav-item logged-out-nav">
                        <a class="nav-link" href="signup.html">
                            <i class="fas fa-user-plus"></i> Sign Up
                        </a>
                    </li> -->
                    <!-- Mode Switch Icon -->
                    <!-- <li class="nav-item">
                        <a class="nav-link" href="#" id="modeSwitch" onclick="toggleMode()">
                            <i class="fas fa-moon"></i>
                        </a>
                    </li> -->
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5 fade-in">
        <h2 class="text-center mb-4 text-light mode-dependent-text">Interactive Career Pathway</h2>

        <!-- User Profile Summary -->
        <div class="card fade-in profile-summary">
            <div class="card-body">
                <h3 class="card-title mode-dependent-text">Your Profile</h3>
                <div id="user-summary" class="mt-3">
                    <!-- Profile data will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Career Pathway Visualization -->
        <div class="card fade-in">
            <div class="card-body">
                <button id="refreshPathway" class="btn btn-primary mb-4 w-100">
                    <i class="fas fa-route me-2"></i>
                    <span class="btn-text">Generate Career Pathway</span>
                    <span class="spinner-border spinner-border-sm btn-spinner" role="status" aria-hidden="true"></span>
                </button>
                <div class="spinner-border text-light" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
                <div id="careerPathway" class="svg-container"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {


            // Initialize theme
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDarkScheme) {
                document.body.classList.remove('light-mode');
            } else {
                document.body.classList.add('light-mode');
            }

            // Load user profile from session storage
            const profile = JSON.parse(sessionStorage.getItem('userProfile')) || {};
            if (profile) {
                // Display user profile summary
                document.getElementById('user-summary').innerHTML = `
                    <p><strong>Bio:</strong> ${profile.bio || 'Not provided'}</p>
                    <p><strong>Skills:</strong> ${profile.skills || 'Not provided'}</p>
                    <p><strong>Career Goals:</strong> ${profile.careerGoals || 'Not provided'}</p>
                    <p><strong>Location:</strong> ${profile.location || 'Not provided'}</p>
                    <p><strong>Experience:</strong> ${profile.experience || 'Not provided'} years</p>
                `;
            }

            // Generate career pathway button
            document.getElementById('refreshPathway').addEventListener('click', function () {
                generateCareerPathway(this);
            });
        });

        function setLoadingState(button, loading) {
            if (!button) return;

            try {
                const cardBody = button.closest('.card-body');
                const btnText = button.querySelector('.btn-text');
                const btnSpinner = button.querySelector('.btn-spinner');

                if (loading) {
                    if (cardBody) cardBody.classList.add('loading');
                    button.classList.add('loading');
                    button.disabled = true;
                    if (btnText) btnText.textContent = 'Generating Pathway...';
                    if (btnSpinner) btnSpinner.style.display = 'inline-block';
                } else {
                    if (cardBody) cardBody.classList.remove('loading');
                    button.classList.remove('loading');
                    button.disabled = false;
                    if (btnText) btnText.textContent = 'Generate Career Pathway';
                    if (btnSpinner) btnSpinner.style.display = 'none';
                }
            } catch (error) {
                console.error('setLoadingState error:', error);
            }
        }

        async function generateCareerPathway(button) {
            setLoadingState(button, true);

            const profile = JSON.parse(sessionStorage.getItem('userProfile'));
            if (!profile || !profile.skills || !profile.careerGoals) {
                const alertHtml = '<div class="alert alert-warning"><i class="fas fa-exclamation-triangle me-2"></i>Please complete your profile first on the home page to get personalized career pathway recommendations.</div>';
                document.getElementById('careerPathway').innerHTML = alertHtml;
                setLoadingState(button, false);
                return;
            }

            const promptTemplate = `Create a comprehensive career pathway graph for someone with these skills: '${profile.skills}' and these career goals: '${profile.careerGoals}'. 
    Include their current experience level: '${profile.experience || 'Not specified'}' years and location: '${profile.location || 'Not specified'}'.
    
    Return a JSON object with 'nodes' and 'links' arrays for D3.js visualization. 
    Each node should have 'id', 'name', 'level' (beginner/intermediate/advanced/expert/goal), and 'description' properties. 
    Each link should have 'source', 'target', and 'value' properties. 
    
    Structure the pathway from current skills to career goals with intermediate roles, skills, certifications, and learning milestones.
    Include 8-12 nodes for a comprehensive pathway.
    Format as valid JSON only, no explanations or markdown formatting.`;

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDNeMYy5q3mGJv7-Bj6KMwPmDL6f51RJ9s`,
                    {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: promptTemplate }] }],
                            generationConfig: {
                                temperature: 0.7,
                                topK: 40,
                                topP: 0.95,
                                maxOutputTokens: 2048,
                            }
                        }),
                        signal: controller.signal
                    }
                );

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`API request failed with status: ${response.status}`);
                }

                const data = await response.json();

                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0]) {
                    throw new Error('Invalid API response format');
                }

                const text = data.candidates[0].content.parts[0].text;

                if (!text || text.trim() === '') {
                    throw new Error('Empty response from API');
                }

                // Enhanced JSON parsing with better error handling
                let jsonData;
                try {
                    // Remove any markdown formatting
                    let cleanText = text.replace(/```json\s*|\s*```/g, '').trim();

                    // Try to find JSON object in the text
                    const jsonMatch = cleanText.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        cleanText = jsonMatch[0];
                    }

                    jsonData = JSON.parse(cleanText);

                    // Validate the structure
                    if (!jsonData.nodes || !Array.isArray(jsonData.nodes) || !jsonData.links || !Array.isArray(jsonData.links)) {
                        throw new Error('Invalid JSON structure');
                    }

                    console.log('Career pathway data loaded:', jsonData);
                    drawCareerPathway(jsonData);

                } catch (jsonError) {
                    console.error('Error parsing JSON:', jsonError);
                    console.log('Raw API response:', text);
                    document.getElementById('careerPathway').innerHTML =
                        '<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>Error generating career pathway. Please try again.</div>';
                }

            } catch (error) {
                console.error('API Error:', error);

                let errorMessage = '<div class="alert alert-danger"><i class="fas fa-exclamation-circle me-2"></i>';
                if (error.name === 'AbortError') {
                    errorMessage += 'Request timed out. Please try again.</div>';
                } else if (error.message.includes('429')) {
                    errorMessage += 'Too many requests. Please wait a moment and try again.</div>';
                } else if (error.message.includes('network') || error.message.includes('fetch')) {
                    errorMessage += 'Network error. Please check your connection and try again.</div>';
                } else {
                    errorMessage += 'Error connecting to the API. Please try again.</div>';
                }

                document.getElementById('careerPathway').innerHTML = errorMessage;

            } finally {
                setLoadingState(button, false);
            }
        }

        function drawCareerPathway(careerPathwayData) {
            d3.select('#careerPathway').select('svg').remove();

            if (!careerPathwayData.nodes || !careerPathwayData.nodes.length) {
                console.log("No career pathway data available.");
                return;
            }

            const container = document.getElementById('careerPathway');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const svg = d3.select('#careerPathway').append('svg')
                .attr('width', width)
                .attr('height', height)
                .style('background', 'transparent')
                .append('g');

            // Add zoom functionality
            const zoom = d3.zoom()
                .scaleExtent([0.5, 3])
                .on('zoom', (event) => {
                    svg.attr('transform', event.transform);
                });

            d3.select('#careerPathway svg').call(zoom);

            // Define color scale for node levels
            const colorScale = d3.scaleOrdinal()
                .domain(['beginner', 'intermediate', 'advanced', 'expert', 'goal'])
                .range(['#4CAF50', '#2196F3', '#9C27B0', '#FF9800', '#f44336']);

            // Create arrow markers for the links
            svg.append('defs').selectAll('marker')
                .data(['arrow'])
                .enter().append('marker')
                .attr('id', d => d)
                .attr('viewBox', '0 -5 10 10')
                .attr('refX', 25)
                .attr('refY', 0)
                .attr('markerWidth', 6)
                .attr('markerHeight', 6)
                .attr('orient', 'auto')
                .append('path')
                .attr('d', 'M0,-5L10,0L0,5')
                .attr('fill', '#999');

            const simulation = d3.forceSimulation(careerPathwayData.nodes)
                .force('link', d3.forceLink(careerPathwayData.links).id(d => d.id).distance(150))
                .force('charge', d3.forceManyBody().strength(-300))
                .force('center', d3.forceCenter(width / 2, height / 2))
                .force('collide', d3.forceCollide().radius(60));

            const link = svg.append('g')
                .attr('class', 'links')
                .selectAll('line')
                .data(careerPathwayData.links)
                .enter().append('line')
                .attr('stroke-width', d => d.value || 2)
                .attr('stroke', '#999')
                .attr('marker-end', 'url(#arrow)');

            const nodeGroup = svg.append('g')
                .attr('class', 'nodes')
                .selectAll('g')
                .data(careerPathwayData.nodes)
                .enter().append('g');

            const node = nodeGroup.append('circle')
                .attr('r', d => d.level === 'goal' ? 25 : 20)
                .attr('fill', d => colorScale(d.level || 'intermediate'))
                .call(d3.drag()
                    .on('start', dragstarted)
                    .on('drag', dragged)
                    .on('end', dragended));

            // Add a subtle pulsing animation to goal nodes
            nodeGroup.filter(d => d.level === 'goal')
                .append('circle')
                .attr('r', 25)
                .attr('fill', 'none')
                .attr('stroke', '#f44336')
                .attr('stroke-width', 2)
                .attr('opacity', 0.7)
                .append('animate')
                .attr('attributeName', 'r')
                .attr('values', '25;35;25')
                .attr('dur', '3s')
                .attr('repeatCount', 'indefinite');

            const label = nodeGroup.append('text')
                .attr('dy', 30)
                .attr('text-anchor', 'middle')
                .text(d => formatNodeLabel(d.name))
                .style('font-size', '12px')
                .style('fill', document.body.classList.contains('light-mode') ? '#000' : '#fff')
                .style('pointer-events', 'none')
                .style('text-shadow', '0 1px 2px rgba(0,0,0,0.8)');

            // Add tooltips
            nodeGroup.append('title')
                .text(d => d.name);

            simulation.on('tick', () => {
                link.attr('x1', d => d.source.x)
                    .attr('y1', d => d.source.y)
                    .attr('x2', d => d.target.x)
                    .attr('y2', d => d.target.y);

                nodeGroup.attr('transform', d => `translate(${d.x},${d.y})`);
            });

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        }

        function formatNodeLabel(text) {
            // Truncate long labels
            return text.length > 20 ? text.substring(0, 17) + '...' : text;
        }

        // Dark/Light mode toggle function
        function toggleMode() {
            document.body.classList.toggle('light-mode');
            const isDarkMode = !document.body.classList.contains('light-mode');
            document.getElementById('modeSwitch').innerHTML = isDarkMode ?
                '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        }

        // Logout function
        function logout() {
            sessionStorage.removeItem('isLoggedIn');
            sessionStorage.removeItem('username');
            window.location.href = 'login.html';
        }
    </script>
    
</body>

</html>